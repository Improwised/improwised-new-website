---
import { type CollectionEntry, getCollection } from "astro:content";
import Layout from "$lib/layouts/Layout.astro";
import { BASE_URL } from "$lib/consts";
import { Badge } from "$lib/components/ui/badge";
import { render } from "astro:content";
import CTASection from "$lib/components/CTASection.astro";
import { CircleUserRound } from "lucide-svelte";
import ShareDropdown from "$lib/components/common/ShareDropdown.svelte";
import detailsBg from "$lib/images/blogs/detailsBg.svg";
import * as Card from "$lib/components/ui/card";
import { Image } from "astro:assets";
import avtarImage from "$lib/images/blogs/impro.png";
export async function getStaticPaths() {
    const blogs = await getCollection("blogs");
    return blogs.map((blog) => ({
        params: { slug: blog.id },
        props: blog,
    }));
}
type Props = CollectionEntry<"blogs">;

const blog = Astro.props;
const { Content } = await render(blog);

// Recommended blogs
const allBlogs = await getCollection("blogs");
const filteredBlogs = allBlogs.filter((b) => b.id !== blog.id);

// Sort by publishDate (latest first)
const sortedBlogs = filteredBlogs.sort(
    (a, b) =>
        new Date(b.data.publishDate).getTime() -
        new Date(a.data.publishDate).getTime(),
);

// Get the latest 3 blogs
const recommendedBlogs = sortedBlogs.slice(0, 3);

// Meta title and description
const seoContents = await getCollection('seocontent');
const [{title, description}] = (seoContents[0].data).filter((content) => content.slug == "blog")
---

<Layout title={title} description={description}>
    <main class="main-content">
        <section
            class="section1 text-left py-40 px-6 bg-image relative pt-[30%] md:pb-40 lg:pt-[12%]"
            style={`background-image: url(${detailsBg.src})`}
        >
            <!-- Main Heading -->
            <div class="container">
                <span
                    class="font-manrope color-[#424242] uppercase font-extra-bold text-left text-[16px] leading-[24px] tracking-widest"
                >
                    {blog.data.publishDate.toDateString()}
                </span>
                <h1
                    class="font-manrope text-left mt-4 mb-6 max-md:text-center main-heading-small md:main-heading"
                >
                    {blog.data.title}
                </h1>

                <div class="flex justify-between items-center gap-4">
                    <!-- Author Info -->
                    <div class="flex items-center gap-2">
                        <Image
                            alt="feature"
                            class="rounded-full"
                            width={56}
                            height={56}
                            src={avtarImage}
                        />
                        <p
                            class="font-semibold text-[#292929] text-[18px] tracking-tight"
                        >
                            By {blog.data.author}
                            <br />
                            <span
                                class="font-normal text-[#292929] text-[16px] leading-[18px] tracking-tight"
                            >
                                Improwised Technologies Pvt. Ltd.
                            </span>
                        </p>
                    </div>
                    <!-- Will do in next phase <ShareDropdown client:load /> -->
                </div>
            </div>
        </section>
        <!-- <section class="pb-20">
            <div class="relative">
                <Card.Root
                    class="shadow-xs border-0 w-full max-w-4xl mx-auto -mt-24"
                >
                    <div class="">
                        <Card.Content>
                            <Image
                                alt="feature"
                                class="w-full"
                                src={blog.data.image}
                            />
                        </Card.Content>
                        <Card.Footer />
                    </div>
                </Card.Root>
            </div>
        </section> -->
        <section class="pt-20 pb-10 section">
            <div class="container">
                <Content />
            </div>
        </section>

        <section class="py-10 md:py-20 section">
            <div class="container">
                <Badge class="mb-10" variant="outline"
                    ><CircleUserRound
                        width="16"
                        height="16"
                        class="mr-1 w-[16px]"
                    />Featured Blogs</Badge
                >
                <div
                    class="grid grid-cols-3 max-md:grid-cols-1 max-lg:grid-cols-2 gap-8"
                >
                    {
                        recommendedBlogs.map((blog, index) => (
                            <>
                                <Card.Root class="shadow-nav border-0 hover:scale-[1.1] transition-transform duration-500">
                                    <div class="">
                                        <Card.Header class="md:p-0 text-center ">
                                            <Image
                                                alt="feature"
                                                class="w-full rounded-t-[12px]"
                                                decoding="async"
                                                loading="lazy"
                                                src={blog.data.image}
                                            />
                                        </Card.Header>
                                        <Card.Content class="">
                                            <p class="mb-2 font-manrope text-[#A3A3A3] text-[16px] leading-[24px] tracking-[16%] uppercase">
                                                {blog.data.publishDate.toDateString()}
                                            </p>
                                            <Card.Title class="text-[20px] color-[#1414] font-manrope font-bold leading-[24px] tracking-tight">
                                                <a
                                                    href={
                                                        BASE_URL +
                                                        "/blogs/" +
                                                        blog.data.slug
                                                    }
                                                >
                                                    {blog.data.title}
                                                </a>
                                            </Card.Title>
                                        </Card.Content>
                                        <Card.Footer>
                                            <div class=" flex gap-x-2 items-center">
                                                <Image
                                                    alt="feature"
                                                    class="rounded-full"
                                                    width={56}
                                                    height={56}
                                                    src={avtarImage}
                                                />
                                                <p class="font-semibold text-[#292929] text-[18px] tracking-tight">
                                                    By {blog.data.author}
                                                    <br />
                                                    <span class="font-normal text-[#292929] text-[16px] leading-[18px] tracking-tight">
                                                        Improwised Technologies
                                                        Pvt. Ltd.
                                                    </span>
                                                </p>
                                            </div>
                                        </Card.Footer>
                                    </div>
                                </Card.Root>
                            </>
                        ))
                    }
                </div>
            </div>
        </section>

        <CTASection />
    </main>
</Layout>
<style>
    .bg-image {
        background-size: cover, contain;
        background-position: center, center;
        background-repeat: no-repeat, no-repeat;
    }
</style>
