---
import { Image } from "astro:assets";
import { Button } from "$lib/components/ui/button";
import { Badge } from "$lib/components/ui/badge";
import CircleUserRound from "lucide-svelte/icons/circle-user-round";
import SectionTitle from "$lib/components/common/SectionTitle.svelte";
import * as Card from "$lib/components/ui/card";
import { getCollection } from "astro:content";
import { BASE_URL } from "$lib/consts";

const services = await getCollection("services", ({ data }) => {
    return data.slug !== "platform-engineering";
});

let gradientX = 45.5;
let gradientY = -200;
---

<section class="section bg-white overflow-hidden relative pt-40 pb-20">
    <svg
        viewBox="0 0 1440 181"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        class="absolute inset-x-0 top-0 w-full block"
        data-v-baf90ddd=""
        ><mask id="path-1-inside-1_1086_7239" fill="white"
            ><path d="M0 0H1440V181H0V0Z"></path></mask
        ><path
            d="M0 0H1440V181H0V0Z"
            fill="url(#paint0_linear_1086_7239)"
            fill-opacity="0.22"></path><path
            d="M0 2H1440V-2H0V2Z"
            fill="url(#paint1_linear_1086_7239)"
            mask="url(#path-1-inside-1_1086_7239)"></path><defs
            ><linearGradient
                id="paint0_linear_1086_7239"
                x1="720"
                y1="0"
                x2="720"
                y2="181"
                gradientUnits="userSpaceOnUse"
                ><stop stop-color="#00afdb"></stop><stop
                    offset="1"
                    stop-color="#00afdb"
                    stop-opacity="0"></stop></linearGradient
            ><linearGradient
                id="paint1_linear_1086_7239"
                x1="0"
                y1="90.5"
                x2="1440"
                y2="90.5"
                gradientUnits="userSpaceOnUse"
                ><stop stop-color="#00afdb" stop-opacity="0"></stop><stop
                    offset="0.395"
                    stop-color="#00afdb"></stop><stop
                    offset="1"
                    stop-color="#00afdb"
                    stop-opacity="0"></stop></linearGradient
            ></defs
        ></svg
    >
    <div class="container">
        <div
            class="mb-12 text-center mx-auto flex max-w-3xl flex-col items-center justify-center"
        >
            <Badge
                class="border border-[#737373] rounded-full text-[#737373] mb-4 ring-gray-300 uppercase"
                variant="outline"
                ><CircleUserRound class="mr-1 w-[16px]" />Services</Badge
            >
            <SectionTitle text="Technologies" primaryColorText="we work with" />
        </div>
        <div
            class="flex flex-wrap features-grid text-center justify-center gap-4 p-4"
        >
            <div class="mt-10 grid gap-10 md:grid-cols-3 lg:grid-cols-3">
                {
                    services.map((service, index) => (
                        <>
                            <Card.Root
                                class="card-custom shadow-nav text-center"
                                onmousemove="updateGradient(event)"
                                style={`--gradient-x: ${gradientX}px; --gradient-y: ${gradientY}px;`}
                            >
                                <div
                                    class="card-custom-inner"
                                    style={`--gradient-x: ${gradientX}px; --gradient-y: ${gradientY}px;`}
                                    onmousemove="updateGradient(event)"
                                >
                                    <Card.Header class="">
                                        <Image
                                            alt="feature"
                                            class="ml-auto mr-auto max-md:w-[208px] w-[208px] "
                                            src={service.data.image}
                                        />
                                    </Card.Header>
                                    <Card.Content>
                                        <Card.Title class="text-[26px]">
                                            <a
                                                href={
                                                    BASE_URL +
                                                    "/services/" +
                                                    service?.data.slug
                                                }
                                            >
                                                {service.data.title}
                                            </a>
                                        </Card.Title>
                                    </Card.Content>
                                    <Card.Footer class="block">
                                        <p>{service.data.description}</p>
                                        <Button
                                            href={
                                                BASE_URL +
                                                "/services/" +
                                                service?.data.slug
                                            }
                                            class="bg-black mt-10"
                                        >
                                            {" "}
                                            Learn More
                                        </Button>
                                    </Card.Footer>
                                </div>
                            </Card.Root>
                        </>
                    ))
                }
            </div>
        </div>
    </div>
</section>

<script is:inline>
    // Function to update gradient position
    function updateGradient(event) {
        const rect = event.currentTarget.getBoundingClientRect();
        gradientX = event.clientX - rect.left;
        gradientY = event.clientY - rect.top;

        // Update the style dynamically
        const target = event.currentTarget;
        target.style.setProperty("--gradient-x", `${gradientX}px`);
        target.style.setProperty("--gradient-y", `${gradientY}px`);
    }
</script>
